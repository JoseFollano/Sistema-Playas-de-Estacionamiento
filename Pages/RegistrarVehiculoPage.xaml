<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:conv="clr-namespace:sistemaPlaya.Converters"
             x:Class="sistemaPlaya.Pages.RegistrarVehiculoPage"
             Title="Registrar Vehículo"
             BackgroundColor="#F8F9FA">

    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Paleta de colores-->
            <Color x:Key="Primary">#1976D2</Color>
            <Color x:Key="Success">#2E7D32</Color>
            <Color x:Key="Danger">#C62828</Color>
            <Color x:Key="Warning">#EF6C00</Color>
            <Color x:Key="Info">#0288D1</Color>

            <!-- Otros Colores-->
            <Color x:Key="Surface">#FFFFFF</Color>
            <Color x:Key="SurfaceVariant">#F5F5F5</Color>
            <Color x:Key="OnSurface">#121212</Color>
            <Color x:Key="OnSurfaceVariant">#424242</Color>
            <Color x:Key="Outline">#9E9E9E</Color>
            <Color x:Key="OutlineVariant">#BDBDBD</Color>

            <Style TargetType="Label">
                <Setter Property="TextColor" Value="{StaticResource OnSurface}" />
                <Setter Property="FontSize" Value="14" />
            </Style>

            <Style TargetType="Frame">
                <Setter Property="BackgroundColor" Value="{StaticResource Surface}" />
                <Setter Property="BorderColor" Value="{StaticResource OutlineVariant}" />
                <Setter Property="CornerRadius" Value="8" />
                <Setter Property="HasShadow" Value="True" />
                <Setter Property="Padding" Value="12" />
                <Setter Property="Margin" Value="0,0,0,8" />
            </Style>

            <Style TargetType="Button">
                <Setter Property="CornerRadius" Value="6" />
                <Setter Property="FontSize" Value="14" />
                <Setter Property="Padding" Value="12" />
                <Setter Property="TextColor" Value="White" />
                <Setter Property="HeightRequest" Value="40" />
                <Setter Property="FontAttributes" Value="Bold" />
            </Style>

            <Style x:Key="PrimaryButton" TargetType="Button">
                <Setter Property="BackgroundColor" Value="{StaticResource Primary}" />
            </Style>

            <Style x:Key="SuccessButton" TargetType="Button">
                <Setter Property="BackgroundColor" Value="{StaticResource Success}" />
            </Style>

            <Style x:Key="DangerButton" TargetType="Button">
                <Setter Property="BackgroundColor" Value="{StaticResource Danger}" />
            </Style>

            <Style x:Key="WarningButton" TargetType="Button">
                <Setter Property="BackgroundColor" Value="{StaticResource Warning}" />
            </Style>

            <conv:RegistrarButtonColorConverter x:Key="RegistrarButtonColorConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <!-- ScrollView-->
    <ScrollView Padding="12" VerticalScrollBarVisibility="Never">
        <VerticalStackLayout Spacing="12">

            <Frame Padding="12">
                <Grid ColumnDefinitions="Auto,*,Auto,*,Auto,*" 
                      ColumnSpacing="12" 
                      HorizontalOptions="Center">
                    <Label Text="Total:" Grid.Column="0"
                           FontAttributes="Bold" FontSize="12"/>
                    <Label Text="{Binding NumeroEstacionamiento}" Grid.Column="1" 
                           FontSize="12"/>

                    <Label Text="Ocupados:" Grid.Column="2" 
                           FontAttributes="Bold" FontSize="12"/>
                    <Label Text="{Binding Ocupados}" Grid.Column="3" 
                           FontSize="12" TextColor="{StaticResource Danger}"/>

                    <Label Text="Libres:" Grid.Column="4" 
                           FontAttributes="Bold" FontSize="12"/>
                    <Label Text="{Binding Disponibles}" Grid.Column="5" 
                           FontSize="12" TextColor="{StaticResource Success}"/>
                </Grid>
            </Frame>

            <!-- Placa del vehículo-->
            <Frame>
                <VerticalStackLayout Spacing="8">
                    <Label Text="PLACA DEL VEHÍCULO" 
                           FontAttributes="Bold" 
                           FontSize="16"
                           TextColor="{StaticResource Primary}"
                           HorizontalOptions="Center"/>

                    <Entry x:Name="EntryPlaca"
                           Placeholder="INGRESE PLACA (Ej: ABC123)"
                           Text="{Binding Placa}"
                           MaxLength="6"
                           Completed="OnPlacaCompleted"
                           BackgroundColor="{StaticResource SurfaceVariant}"
                           Keyboard="Text"
                           HorizontalTextAlignment="Center"
                           FontSize="20"
                           FontAttributes="Bold"
                           HeightRequest="50"/>

                    <Label Text="{Binding EstadoIngreso}" 
                           FontAttributes="Bold" 
                           TextColor="{Binding EstadoIngresoColor}"
                           HorizontalOptions="Center"
                           FontSize="14"/>
                </VerticalStackLayout>
            </Frame>

            <Frame>
                <VerticalStackLayout Spacing="1">
                    <Label Text="TIPO DE VEHÍCULO" 
                           FontAttributes="Bold" 
                           FontSize="14"
                           TextColor="{StaticResource OnSurfaceVariant}"/>

                    <Picker x:Name="PickerTipoVehiculo"
                            Title="Seleccione tipo de vehículo"
                            ItemsSource="{Binding TiposVehiculo}"
                            SelectedItem="{Binding TipoVehiculo}"
                            BackgroundColor="{StaticResource SurfaceVariant}"
                            HeightRequest="60"
                            FontSize="14"
                            TextColor="{StaticResource OnSurface}"
                            Margin="0,10,0,15"/>

                    <BoxView HeightRequest="1" Color="{StaticResource OutlineVariant}" Margin="0,8"/>

                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                        <Label Text="TARIFA POR HORA:" 
                               FontAttributes="Bold" 
                               FontSize="14"
                               VerticalOptions="Center"/>
                        <Label Text="{Binding TarifaHora, StringFormat='S/. {0:F2}'}" 
                               Grid.Column="1"
                               FontAttributes="Bold"
                               FontSize="18"
                               TextColor="{StaticResource Success}"
                               VerticalOptions="Center"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Campo de Observación -->
            <Frame>
                <VerticalStackLayout Spacing="8">
                    <Label Text="OBSERVACIÓN (OPCIONAL)" 
                           FontAttributes="Bold" 
                           FontSize="14"
                           TextColor="{StaticResource OnSurfaceVariant}"/>

                    <Entry Text="{Binding Observacion}" 
                           Placeholder="Ej: color, modelo, etc."
                           BackgroundColor="{StaticResource SurfaceVariant}"
                           HeightRequest="40"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Botones de acción-->
            <Grid ColumnDefinitions="*,*,*" ColumnSpacing="8" RowDefinitions="Auto,Auto" RowSpacing="8">
                <Button Text="REGISTRAR" 
                        Grid.Column="0" Grid.Row="0"
                        Style="{StaticResource SuccessButton}"
                        IsEnabled="{Binding RegistrarHabilitado}"
                        Clicked="OnRegistrarClicked"/>

                <Button Text="PLAN" 
                        Grid.Column="1" Grid.Row="0"
                        Style="{StaticResource PrimaryButton}"
                        Clicked="OnCambiarPlanClicked"
                        IsEnabled="{Binding CambiarPlanHabilitado}">
                    <Button.Triggers>
                        <DataTrigger TargetType="Button" Binding="{Binding CambiarPlanHabilitado}" Value="False">
                            <Setter Property="Opacity" Value="0.5" />
                        </DataTrigger>
                    </Button.Triggers>
                </Button>

                <Button Text="ANULAR" 
                        Grid.Column="2" Grid.Row="0"
                        Style="{StaticResource DangerButton}"
                        Clicked="OnAnularClicked"/>
            </Grid>

            <!-- Sección de pago (solo visible para salida) -->
            <Frame IsVisible="{Binding MostrarPago}" 
                   BackgroundColor="{StaticResource SurfaceVariant}">
                <VerticalStackLayout Spacing="10">
                    <Label Text="INFORMACIÓN DE TICKET" 
                           FontAttributes="Bold" 
                           HorizontalOptions="Center"
                           FontSize="16"
                           TextColor="{StaticResource Primary}"/>

                    <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto" 
                          ColumnSpacing="8" RowSpacing="6">
                        <Label Text="Ticket:" Grid.Row="0" Grid.Column="0" 
                               FontAttributes="Bold"/>
                        <Label Text="{Binding NumeroTicket}" Grid.Row="0" Grid.Column="1" 
                               TextColor="{StaticResource Primary}" FontAttributes="Bold"/>

                        <Label Text="Ingreso:" Grid.Row="1" Grid.Column="0" 
                               FontAttributes="Bold"/>
                        <Label Text="{Binding FechaIngreso, StringFormat='{0:dd/MM/yyyy HH:mm}'}" 
                               Grid.Row="1" Grid.Column="1"/>

                        <Label Text="Tiempo:" Grid.Row="2" Grid.Column="0" 
                               FontAttributes="Bold"/>
                        <Label Text="{Binding TiempoEstacionado}" Grid.Row="2" Grid.Column="1"/>

                        <Label Text="TOTAL:" Grid.Row="3" Grid.Column="0" 
                               FontAttributes="Bold" FontSize="16"/>
                        <Label Text="{Binding TotalPagar, StringFormat='S/. {0:F2}'}" 
                               Grid.Row="3" Grid.Column="1"
                               FontAttributes="Bold" FontSize="18" 
                               TextColor="{StaticResource Success}"/>

                        <Label Text="Estado:" Grid.Row="4" Grid.Column="0" 
                               FontAttributes="Bold"/>
                        <Label Text="PENDIENTE" Grid.Row="4" Grid.Column="1" 
                               TextColor="{StaticResource Warning}" FontAttributes="Bold"/>
                    </Grid>

                    <BoxView HeightRequest="1" Color="{StaticResource OutlineVariant}" Margin="0,8"/>

                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="6">
                        <Button Text="PAGAR" Grid.Column="0"
                                Style="{StaticResource SuccessButton}" 
                                FontSize="12"
                                HeightRequest="35"
                                Clicked="OnPagarClicked"/>
                        <Button Text="FACTURA" Grid.Column="1"
                                Style="{StaticResource PrimaryButton}" 
                                FontSize="12"
                                HeightRequest="35"
                                Clicked="OnFacturaClicked"/>
                        <Button Text="BOLETA" Grid.Column="2"
                                Style="{StaticResource WarningButton}" 
                                FontSize="12"
                                HeightRequest="35"
                                Clicked="OnBoletaClicked"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>